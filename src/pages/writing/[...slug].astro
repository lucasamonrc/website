---
import { type CollectionEntry, getCollection, render } from "astro:content";
import Root from "../../layouts/Root.astro";

export async function getStaticPaths() {
	const posts = await getCollection("posts");
	return posts.map((post) => ({
		params: { slug: post.id },
		props: post,
	}));
}
type Props = CollectionEntry<"posts">;

const post = Astro.props;
const { Content } = await render(post);
---

<Root
	title={post.data.title}
	description={post.data.description}
	image={post.data.heroImage}
>
	<article>
		<header class="mb-8">
			<h1 class="text-2xl font-bold tracking-tight text-text">
				{post.data.title}
			</h1>
			<div class="mt-2 flex flex-wrap items-center gap-3">
				<time
					datetime={post.data.pubDate.toISOString()}
					class="text-sm text-text-secondary"
				>
					{
						post.data.pubDate.toLocaleDateString("en-US", {
							month: "long",
							day: "numeric",
							year: "numeric",
							timeZone: "UTC",
						})
					}
				</time>
				{
					post.data.tags && post.data.tags.length > 0 && (
						<div class="flex flex-wrap gap-2">
							{post.data.tags.map((tag: string) => (
								<span class="rounded-full bg-bg-secondary px-2 py-0.5 text-xs text-text-secondary">
									{tag}
								</span>
							))}
						</div>
					)
				}
			</div>
		</header>

		<div class="prose max-w-none">
			<Content />
		</div>

		<footer class="mt-12 border-t border-border pt-6">
			<a
				href="/writing"
				class="text-sm text-text-secondary no-underline transition-colors"
			>
				&larr; Back to writing
			</a>
		</footer>
	</article>
</Root>
